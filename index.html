<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Life Skill Tree</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; padding: 0; overflow: hidden; font-family: Georgia, serif; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-bounce { animation: bounce 0.5s ease-in-out; }
    .animate-ping { animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useCallback, useRef, useEffect } = React;

    const SkillTreeApp = () => {
      const svgRef = useRef(null);
      const containerRef = useRef(null);
      
      const defaultNodes = {
        'start': {
          id: 'start', name: 'Starting Point', description: 'Your journey begins here',
          xp: 0, requires: [], path: 'default', x: 450, y: 500, completed: false, isMajor: false
        }
      };

      const [nodes, setNodes] = useState(defaultNodes);
      const [selectedNode, setSelectedNode] = useState(null);
      const [editingNode, setEditingNode] = useState(null);
      const [connecting, setConnecting] = useState(null);
      const [dragging, setDragging] = useState(null);
      const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
      const [zoom, setZoom] = useState(0.7);
      const [mode, setMode] = useState('select');
      const [isEditMode, setIsEditMode] = useState(false);
      const [loading, setLoading] = useState(true);
      const [justCompleted, setJustCompleted] = useState(null);
      const [showCompletionEffect, setShowCompletionEffect] = useState(false);

      const pathOptions = [
        { id: 'business', name: 'Business', color: '#22c55e' },
        { id: 'content', name: 'Content', color: '#3b82f6' },
        { id: 'treasury', name: 'Treasury', color: '#eab308' },
        { id: 'freedom', name: 'Freedom', color: '#a855f7' },
        { id: 'income', name: 'Income', color: '#f59e0b' },
        { id: 'relationship', name: 'Relationship', color: '#ec4899' },
        { id: 'health', name: 'Health', color: '#10b981' },
        { id: 'learning', name: 'Learning', color: '#06b6d4' },
        { id: 'convergence', name: 'Convergence', color: '#ef4444' },
        { id: 'ultimate', name: 'Ultimate', color: '#fbbf24' },
        { id: 'default', name: 'Default', color: '#71717a' },
      ];

      const getPathColor = (pathId) => pathOptions.find(p => p.id === pathId)?.color || '#71717a';

      // Load from localStorage
      useEffect(() => {
        try {
          const saved = localStorage.getItem('skill-tree-data');
          if (saved) {
            const parsed = JSON.parse(saved);
            if (parsed.nodes) setNodes(parsed.nodes);
          }
        } catch (e) { console.log('No saved data'); }
        setLoading(false);
      }, []);

      // Save to localStorage
      useEffect(() => {
        if (!loading) {
          localStorage.setItem('skill-tree-data', JSON.stringify({ nodes }));
        }
      }, [nodes, loading]);

      const getNodeStatus = useCallback((node) => {
        const requirementsMet = node.requires.length === 0 || node.requires.every(reqId => nodes[reqId]?.completed);
        
        if (node.completed) {
          const checkUnstable = (nodeId, visited = new Set()) => {
            if (visited.has(nodeId)) return false;
            visited.add(nodeId);
            const n = nodes[nodeId];
            if (!n || !n.completed) return false;
            for (const reqId of (n.requires || [])) {
              const reqNode = nodes[reqId];
              if (!reqNode || !reqNode.completed) return true;
              if (checkUnstable(reqId, visited)) return true;
            }
            return false;
          };
          return checkUnstable(node.id) ? 'unstable' : 'completed';
        }
        return requirementsMet ? 'available' : 'locked';
      }, [nodes]);

      const getMousePosition = (e) => {
        if (!svgRef.current) return { x: 0, y: 0 };
        const rect = svgRef.current.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: (clientX - rect.left) / zoom, y: (clientY - rect.top) / zoom };
      };

      const handleViewModeClick = (nodeId) => {
        const node = nodes[nodeId];
        const status = getNodeStatus(node);
        if (status === 'locked') { setSelectedNode(nodeId); return; }
        
        const wasCompleted = node.completed;
        setNodes(prev => ({ ...prev, [nodeId]: { ...prev[nodeId], completed: !prev[nodeId].completed } }));
        
        if (!wasCompleted) {
          setJustCompleted(nodeId);
          setShowCompletionEffect(true);
          setTimeout(() => { setShowCompletionEffect(false); setJustCompleted(null); }, 1500);
        }
      };

      const handleMouseDown = (e, nodeId) => {
        if (!isEditMode) { handleViewModeClick(nodeId); return; }

        if (mode === 'connect') {
          if (connecting) {
            if (connecting !== nodeId) {
              setNodes(prev => {
                const updated = { ...prev };
                if (!updated[nodeId].requires.includes(connecting)) {
                  updated[nodeId] = { ...updated[nodeId], requires: [...updated[nodeId].requires, connecting] };
                }
                return updated;
              });
            }
            setConnecting(null);
          } else { setConnecting(nodeId); }
          return;
        }

        if (mode === 'delete') { deleteNode(nodeId); return; }

        e.stopPropagation();
        const pos = getMousePosition(e);
        setDragging(nodeId);
        setDragOffset({ x: pos.x - nodes[nodeId].x, y: pos.y - nodes[nodeId].y });
        setSelectedNode(nodeId);
      };

      const handleMouseMove = (e) => {
        if (!dragging || !isEditMode) return;
        const pos = getMousePosition(e);
        setNodes(prev => ({
          ...prev,
          [dragging]: { ...prev[dragging], x: Math.max(0, pos.x - dragOffset.x), y: Math.max(0, pos.y - dragOffset.y) }
        }));
      };

      const handleMouseUp = () => setDragging(null);

      const addNode = () => {
        const id = `node-${Date.now()}`;
        setNodes(prev => ({
          ...prev,
          [id]: { id, name: 'New Node', description: 'Click to edit', xp: 100, requires: [], path: 'default',
                  x: 450 + Math.random() * 100 - 50, y: 300 + Math.random() * 100 - 50, completed: false, isMajor: false }
        }));
        setSelectedNode(id);
        setEditingNode(id);
      };

      const deleteNode = (nodeId) => {
        if (Object.keys(nodes).length <= 1) { alert("Can't delete the last node!"); return; }
        setNodes(prev => {
          const updated = { ...prev };
          delete updated[nodeId];
          Object.keys(updated).forEach(key => {
            updated[key] = { ...updated[key], requires: updated[key].requires.filter(r => r !== nodeId) };
          });
          return updated;
        });
        if (selectedNode === nodeId) setSelectedNode(null);
        if (editingNode === nodeId) setEditingNode(null);
      };

      const updateNode = (nodeId, updates) => setNodes(prev => ({ ...prev, [nodeId]: { ...prev[nodeId], ...updates } }));
      const removeConnection = (fromId, toId) => setNodes(prev => ({
        ...prev, [toId]: { ...prev[toId], requires: prev[toId].requires.filter(r => r !== fromId) }
      }));

      const resetAll = () => {
        if (confirm('Reset everything?')) { setNodes(defaultNodes); setSelectedNode(null); setEditingNode(null); }
      };

      const exportData = () => {
        const blob = new Blob([JSON.stringify({ nodes }, null, 2)], { type: 'application/json' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
        a.download = 'skill-tree-backup.json'; a.click();
      };

      const importData = (e) => {
        const file = e.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (data.nodes) { setNodes(data.nodes); setSelectedNode(null); setEditingNode(null); }
          } catch (err) { alert('Invalid file'); }
        };
        reader.readAsText(file);
      };

      const getConnections = () => {
        const connections = [];
        Object.values(nodes).forEach(node => {
          (node.requires || []).forEach(reqId => {
            if (nodes[reqId]) connections.push({ from: nodes[reqId], to: node });
          });
        });
        return connections;
      };

      const nodeWidth = 160, nodeHeight = 75, canvasWidth = 2000, canvasHeight = 1500;
      const totalXP = Object.values(nodes).filter(n => n.completed).reduce((sum, n) => sum + (n.xp || 0), 0);
      const completedCount = Object.values(nodes).filter(n => n.completed).length;

      if (loading) {
        return (<div style={{height:'100vh',background:'#0c0a09',display:'flex',alignItems:'center',justifyContent:'center'}}>
          <div style={{color:'#fbbf24',fontSize:'1.25rem'}}>Loading...</div>
        </div>);
      }

      return (
        <div style={{height:'100vh',width:'100vw',background:'#0c0a09',overflow:'hidden',display:'flex',flexDirection:'column'}}>
          
          {/* Completion Effect */}
          {showCompletionEffect && justCompleted && (
            <div style={{position:'fixed',inset:0,pointerEvents:'none',zIndex:50,display:'flex',alignItems:'center',justifyContent:'center'}}>
              <div className="animate-ping" style={{position:'absolute',width:'8rem',height:'8rem',borderRadius:'50%',opacity:0.3,background:getPathColor(nodes[justCompleted]?.path)}} />
              <div className="animate-bounce" style={{background:'#1c1917',border:`3px solid ${getPathColor(nodes[justCompleted]?.path)}`,borderRadius:'1rem',padding:'1.5rem',boxShadow:'0 25px 50px -12px rgba(0,0,0,0.5)'}}>
                <div style={{fontSize:'2.5rem',textAlign:'center'}}>‚öîÔ∏è</div>
                <div style={{color:'#fbbf24',fontWeight:'bold',fontSize:'1.5rem',textAlign:'center'}}>ACHIEVED!</div>
                <div style={{color:'white',textAlign:'center',marginTop:'0.25rem'}}>{nodes[justCompleted]?.name}</div>
                <div style={{color:'#f59e0b',textAlign:'center',fontSize:'1.25rem',fontWeight:'bold',marginTop:'0.5rem'}}>+{nodes[justCompleted]?.xp} XP</div>
              </div>
            </div>
          )}

          {/* Header */}
          <div style={{background:'#1c1917',borderBottom:'1px solid #78350f',padding:'0.75rem',zIndex:20,flexShrink:0}}>
            <div style={{display:'flex',flexWrap:'wrap',alignItems:'center',gap:'0.75rem'}}>
              
              {/* View/Edit Toggle */}
              <div style={{display:'flex',border:'2px solid #d97706',borderRadius:'0.5rem',overflow:'hidden'}}>
                <button onClick={() => { setIsEditMode(false); setConnecting(null); setEditingNode(null); }}
                  style={{padding:'0.5rem 1rem',fontSize:'0.875rem',fontWeight:'bold',cursor:'pointer',border:'none',
                    background: !isEditMode ? '#d97706' : '#292524', color: !isEditMode ? '#1c1917' : '#a8a29e'}}>
                  üëÅÔ∏è View
                </button>
                <button onClick={() => setIsEditMode(true)}
                  style={{padding:'0.5rem 1rem',fontSize:'0.875rem',fontWeight:'bold',cursor:'pointer',border:'none',
                    background: isEditMode ? '#d97706' : '#292524', color: isEditMode ? '#1c1917' : '#a8a29e'}}>
                  ‚úèÔ∏è Edit
                </button>
              </div>

              {/* Edit tools */}
              {isEditMode && (<>
                <div style={{width:'1px',height:'2rem',background:'#44403c'}} />
                <div style={{display:'flex',border:'1px solid #44403c',borderRadius:'0.25rem',overflow:'hidden'}}>
                  <button onClick={() => { setMode('select'); setConnecting(null); }}
                    style={{padding:'0.375rem 0.75rem',fontSize:'0.875rem',cursor:'pointer',border:'none',
                      background: mode === 'select' ? '#b45309' : '#292524', color: mode === 'select' ? 'white' : '#a8a29e'}}>‚úã</button>
                  <button onClick={() => { setMode('connect'); setConnecting(null); }}
                    style={{padding:'0.375rem 0.75rem',fontSize:'0.875rem',cursor:'pointer',border:'none',
                      background: mode === 'connect' ? '#1d4ed8' : '#292524', color: mode === 'connect' ? 'white' : '#a8a29e'}}>üîó</button>
                  <button onClick={() => { setMode('delete'); setConnecting(null); }}
                    style={{padding:'0.375rem 0.75rem',fontSize:'0.875rem',cursor:'pointer',border:'none',
                      background: mode === 'delete' ? '#b91c1c' : '#292524', color: mode === 'delete' ? 'white' : '#a8a29e'}}>üóëÔ∏è</button>
                </div>
                <button onClick={addNode} style={{padding:'0.375rem 0.75rem',background:'#166534',color:'#bbf7d0',borderRadius:'0.25rem',
                  fontSize:'0.875rem',cursor:'pointer',border:'none'}}>‚ûï Add</button>
              </>)}

              <div style={{width:'1px',height:'2rem',background:'#44403c'}} />

              {/* Zoom */}
              <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                <button onClick={() => setZoom(z => Math.max(0.3, z - 0.1))} style={{padding:'0.25rem 0.5rem',background:'#292524',color:'#a8a29e',borderRadius:'0.25rem',border:'none',cursor:'pointer'}}>‚àí</button>
                <span style={{color:'#a8a29e',fontSize:'0.875rem',width:'3rem',textAlign:'center'}}>{Math.round(zoom * 100)}%</span>
                <button onClick={() => setZoom(z => Math.min(1.2, z + 0.1))} style={{padding:'0.25rem 0.5rem',background:'#292524',color:'#a8a29e',borderRadius:'0.25rem',border:'none',cursor:'pointer'}}>+</button>
              </div>

              <div style={{width:'1px',height:'2rem',background:'#44403c'}} />

              {/* Stats */}
              <div style={{display:'flex',alignItems:'center',gap:'1rem'}}>
                <div style={{textAlign:'center'}}>
                  <div style={{color:'#fbbf24',fontWeight:'bold',fontSize:'1.125rem'}}>{totalXP.toLocaleString()}</div>
                  <div style={{color:'#57534e',fontSize:'0.75rem'}}>XP</div>
                </div>
                <div style={{textAlign:'center'}}>
                  <div style={{color:'#4ade80',fontWeight:'bold',fontSize:'1.125rem'}}>{completedCount}/{Object.keys(nodes).length}</div>
                  <div style={{color:'#57534e',fontSize:'0.75rem'}}>Done</div>
                </div>
              </div>

              <div style={{flex:1}} />

              {/* Tools */}
              <button onClick={exportData} style={{padding:'0.25rem 0.5rem',background:'#292524',color:'#a8a29e',borderRadius:'0.25rem',fontSize:'0.875rem',border:'none',cursor:'pointer'}}>üíæ</button>
              <label style={{padding:'0.25rem 0.5rem',background:'#292524',color:'#a8a29e',borderRadius:'0.25rem',fontSize:'0.875rem',cursor:'pointer'}}>
                üìÇ<input type="file" accept=".json" onChange={importData} style={{display:'none'}} />
              </label>
              {isEditMode && <button onClick={resetAll} style={{padding:'0.25rem 0.5rem',background:'#450a0a',color:'#f87171',borderRadius:'0.25rem',fontSize:'0.875rem',border:'none',cursor:'pointer'}}>Reset</button>}
            </div>

            {isEditMode && mode === 'connect' && (
              <div style={{marginTop:'0.5rem',fontSize:'0.875rem',color:'#60a5fa'}}>
                üîó {connecting ? `Click node that NEEDS "${nodes[connecting]?.name}"` : 'Click requirement node first'}
              </div>
            )}
          </div>

          {/* Canvas */}
          <div ref={containerRef} style={{flex:1,overflow:'auto',background:'radial-gradient(ellipse at center, #1c1917 0%, #0c0a09 50%, #000 100%)',touchAction:'pan-x pan-y'}}>
            <svg ref={svgRef} width={canvasWidth * zoom} height={canvasHeight * zoom} viewBox={`0 0 ${canvasWidth} ${canvasHeight}`}
              onMouseMove={handleMouseMove} onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp}
              onTouchMove={(e) => handleMouseMove(e.touches[0])} onTouchEnd={handleMouseUp}
              style={{display:'block',minWidth:canvasWidth * zoom,minHeight:canvasHeight * zoom}}>
              
              <defs>
                <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
                  <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#27272a" strokeWidth="0.5" />
                </pattern>
                {pathOptions.map(p => (
                  <filter key={p.id} id={`glow-${p.id}`} x="-100%" y="-100%" width="300%" height="300%">
                    <feGaussianBlur stdDeviation="4" result="blur"/>
                    <feFlood floodColor={p.color} floodOpacity="0.6"/>
                    <feComposite in2="blur" operator="in"/>
                    <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
                  </filter>
                ))}
                <filter id="glow-available" x="-100%" y="-100%" width="300%" height="300%">
                  <feGaussianBlur stdDeviation="6" result="blur"/>
                  <feFlood floodColor="#fbbf24" floodOpacity="0.4"/>
                  <feComposite in2="blur" operator="in"/>
                  <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
                <filter id="glow-unstable" x="-100%" y="-100%" width="300%" height="300%">
                  <feGaussianBlur stdDeviation="5" result="blur"/>
                  <feFlood floodColor="#ef4444" floodOpacity="0.7"/>
                  <feComposite in2="blur" operator="in"/>
                  <feMerge><feMergeNode/><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
              </defs>
              
              <rect width="100%" height="100%" fill="url(#grid)" />

              {/* Connections */}
              {getConnections().map((conn, i) => {
                const fromX = conn.from.x + nodeWidth / 2, fromY = conn.from.y + nodeHeight / 2;
                const toX = conn.to.x + nodeWidth / 2, toY = conn.to.y + nodeHeight / 2;
                const fromStatus = getNodeStatus(conn.from), toStatus = getNodeStatus(conn.to);
                const isActive = fromStatus === 'completed' && toStatus === 'completed';
                const isPartial = fromStatus === 'completed' && toStatus !== 'completed';
                const isUnstable = toStatus === 'unstable';
                const color = isUnstable ? '#ef4444' : isActive ? getPathColor(conn.to.path) : isPartial ? getPathColor(conn.to.path) : '#27272a';
                const path = `M ${fromX} ${fromY} C ${fromX + (toX-fromX)*0.25} ${fromY}, ${fromX + (toX-fromX)*0.75} ${toY}, ${toX} ${toY}`;
                
                return (
                  <g key={i}>
                    {isActive && <path d={path} stroke={color} strokeWidth={8} fill="none" opacity={0.3} />}
                    <path d={path} stroke={color} strokeWidth={isActive ? 4 : isPartial ? 3 : 2} fill="none"
                      opacity={isActive ? 1 : isPartial ? 0.7 : 0.2} strokeDasharray={isPartial && !isActive ? '8,4' : 'none'}
                      className={isUnstable ? 'animate-pulse' : ''} />
                    {isActive && <circle r="4" fill="#fff" opacity="0.8"><animateMotion dur="2s" repeatCount="indefinite" path={path} /></circle>}
                    <circle cx={toX} cy={toY} r={isActive ? 8 : 5} fill={color} opacity={isActive ? 1 : isPartial ? 0.6 : 0.2} />
                  </g>
                );
              })}

              {/* Connect preview */}
              {connecting && isEditMode && (
                <line x1={nodes[connecting].x + nodeWidth/2} y1={nodes[connecting].y + nodeHeight/2}
                  x2={nodes[connecting].x + nodeWidth/2 + 80} y2={nodes[connecting].y + nodeHeight/2}
                  stroke="#3b82f6" strokeWidth="3" strokeDasharray="8,4" className="animate-pulse" />
              )}

              {/* Nodes */}
              {Object.values(nodes).map(node => {
                const color = getPathColor(node.path);
                const status = getNodeStatus(node);
                const isSelected = selectedNode === node.id;
                const isConnectingThis = connecting === node.id;
                
                let fillColor, strokeColor, textColor, opacity, filter;
                if (status === 'completed') { fillColor = color + '40'; strokeColor = color; textColor = '#ffffff'; opacity = 1; filter = `url(#glow-${node.path})`; }
                else if (status === 'unstable') { fillColor = '#450a0a'; strokeColor = '#ef4444'; textColor = '#fca5a5'; opacity = 1; filter = 'url(#glow-unstable)'; }
                else if (status === 'available') { fillColor = '#1c1917'; strokeColor = color; textColor = '#fafaf9'; opacity = 1; filter = 'url(#glow-available)'; }
                else { fillColor = '#0c0a09'; strokeColor = '#27272a'; textColor = '#3f3f46'; opacity = 0.4; filter = ''; }

                return (
                  <g key={node.id} onMouseDown={(e) => handleMouseDown(e, node.id)}
                    onTouchStart={(e) => { e.preventDefault(); handleMouseDown(e, node.id); }}
                    onDoubleClick={() => isEditMode && setEditingNode(node.id)}
                    style={{cursor: isEditMode ? 'grab' : 'pointer', filter, opacity}}
                    className={status === 'unstable' ? 'animate-pulse' : ''}>
                    
                    {(isSelected || isConnectingThis) && (
                      <rect x={node.x - 6} y={node.y - 6} width={nodeWidth + 12} height={nodeHeight + 12} rx={12}
                        fill="none" stroke={isConnectingThis ? '#3b82f6' : '#fbbf24'} strokeWidth="3"
                        strokeDasharray={isConnectingThis ? '8,4' : 'none'} className={isConnectingThis ? 'animate-pulse' : ''} />
                    )}
                    
                    {status === 'available' && !isEditMode && (
                      <rect x={node.x - 4} y={node.y - 4} width={nodeWidth + 8} height={nodeHeight + 8} rx={10}
                        fill="none" stroke="#fbbf24" strokeWidth="2" opacity="0.5" className="animate-pulse" />
                    )}
                    
                    <rect x={node.x} y={node.y} width={nodeWidth} height={nodeHeight} rx={node.isMajor ? 12 : 8}
                      fill={fillColor} stroke={strokeColor} strokeWidth={node.isMajor || status === 'completed' ? 4 : 2} />
                    
                    {status === 'completed' && (<>
                      <circle cx={node.x + nodeWidth - 14} cy={node.y + 14} r={14} fill={color} />
                      <text x={node.x + nodeWidth - 14} y={node.y + 20} fill="#000" fontSize="16" textAnchor="middle" fontWeight="bold">‚úì</text>
                    </>)}
                    
                    {status === 'unstable' && <text x={node.x + nodeWidth - 16} y={node.y + 22} fontSize="20">‚ö†Ô∏è</text>}
                    {status === 'locked' && <text x={node.x + nodeWidth - 16} y={node.y + 20} fontSize="14" opacity="0.5">üîí</text>}
                    
                    <text x={node.x + nodeWidth/2} y={node.y + 32} fill={textColor} fontSize="14" fontWeight="bold" textAnchor="middle" style={{pointerEvents:'none'}}>
                      {node.name.length > 18 ? node.name.slice(0, 16) + '...' : node.name}
                    </text>
                    <text x={node.x + nodeWidth/2} y={node.y + 54} fill={textColor} fontSize="13" fontWeight="600" textAnchor="middle" opacity="0.8" style={{pointerEvents:'none'}}>
                      +{node.xp} XP
                    </text>
                    
                    {status === 'available' && !isEditMode && (
                      <text x={node.x + nodeWidth/2} y={node.y + nodeHeight + 18} fill="#fbbf24" fontSize="11" textAnchor="middle" className="animate-pulse">
                        Tap to complete
                      </text>
                    )}
                  </g>
                );
              })}
            </svg>
          </div>

          {/* Selected Node Panel (View Mode) */}
          {selectedNode && !isEditMode && nodes[selectedNode] && (
            <div style={{position:'fixed',bottom:'1rem',right:'1rem',zIndex:30,background:'rgba(28,25,23,0.98)',backdropFilter:'blur(8px)',
              border:`2px solid ${getPathColor(nodes[selectedNode].path)}`,borderRadius:'0.75rem',padding:'1rem',maxWidth:'18rem',boxShadow:'0 25px 50px -12px rgba(0,0,0,0.5)'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'0.5rem'}}>
                <h3 style={{fontSize:'1.125rem',fontWeight:'bold',color:getPathColor(nodes[selectedNode].path),margin:0}}>{nodes[selectedNode].name}</h3>
                <button onClick={() => setSelectedNode(null)} style={{color:'#57534e',background:'none',border:'none',fontSize:'1.25rem',cursor:'pointer'}}>√ó</button>
              </div>
              <p style={{color:'#d6d3d1',fontSize:'0.875rem',marginBottom:'0.75rem'}}>{nodes[selectedNode].description}</p>
              <div style={{color:'#fbbf24',fontWeight:'bold',marginBottom:'0.75rem'}}>+{nodes[selectedNode].xp} XP</div>
              
              {nodes[selectedNode].requires.length > 0 && getNodeStatus(nodes[selectedNode]) === 'locked' && (
                <div style={{paddingTop:'0.5rem',borderTop:'1px solid #44403c'}}>
                  <div style={{color:'#57534e',fontSize:'0.75rem',marginBottom:'0.25rem'}}>Requires:</div>
                  <div style={{display:'flex',flexWrap:'wrap',gap:'0.25rem'}}>
                    {nodes[selectedNode].requires.map(reqId => {
                      const reqNode = nodes[reqId];
                      const reqStatus = getNodeStatus(reqNode);
                      return (
                        <span key={reqId} style={{fontSize:'0.75rem',padding:'0.25rem 0.5rem',borderRadius:'0.25rem',
                          background: reqStatus === 'completed' ? 'rgba(34,197,94,0.2)' : '#292524',
                          color: reqStatus === 'completed' ? '#86efac' : '#a8a29e'}}>
                          {reqStatus === 'completed' ? '‚úì ' : ''}{reqNode?.name}
                        </span>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Edit Panel */}
          {editingNode && isEditMode && nodes[editingNode] && (
            <div style={{position:'fixed',right:'1rem',top:'5rem',zIndex:30,background:'#1c1917',border:'1px solid #78350f',borderRadius:'0.5rem',padding:'1rem',width:'18rem',maxHeight:'80vh',overflowY:'auto',boxShadow:'0 25px 50px -12px rgba(0,0,0,0.5)'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'1rem'}}>
                <h3 style={{color:'#fbbf24',fontWeight:'bold',margin:0}}>Edit Node</h3>
                <button onClick={() => setEditingNode(null)} style={{color:'#57534e',background:'none',border:'none',fontSize:'1.25rem',cursor:'pointer'}}>√ó</button>
              </div>

              <div style={{display:'flex',flexDirection:'column',gap:'1rem'}}>
                <div>
                  <label style={{color:'#a8a29e',fontSize:'0.875rem',display:'block',marginBottom:'0.25rem'}}>Name</label>
                  <input type="text" value={nodes[editingNode].name} onChange={(e) => updateNode(editingNode, { name: e.target.value })}
                    style={{width:'100%',padding:'0.5rem',background:'#292524',border:'1px solid #44403c',borderRadius:'0.25rem',color:'#fef3c7',boxSizing:'border-box'}} />
                </div>

                <div>
                  <label style={{color:'#a8a29e',fontSize:'0.875rem',display:'block',marginBottom:'0.25rem'}}>Description</label>
                  <textarea value={nodes[editingNode].description} onChange={(e) => updateNode(editingNode, { description: e.target.value })}
                    style={{width:'100%',padding:'0.5rem',background:'#292524',border:'1px solid #44403c',borderRadius:'0.25rem',color:'#fef3c7',height:'5rem',boxSizing:'border-box',resize:'vertical'}} />
                </div>

                <div>
                  <label style={{color:'#a8a29e',fontSize:'0.875rem',display:'block',marginBottom:'0.25rem'}}>XP Reward</label>
                  <input type="number" value={nodes[editingNode].xp} onChange={(e) => updateNode(editingNode, { xp: parseInt(e.target.value) || 0 })}
                    style={{width:'100%',padding:'0.5rem',background:'#292524',border:'1px solid #44403c',borderRadius:'0.25rem',color:'#fef3c7',boxSizing:'border-box'}} />
                </div>

                <div>
                  <label style={{color:'#a8a29e',fontSize:'0.875rem',display:'block',marginBottom:'0.25rem'}}>Category</label>
                  <select value={nodes[editingNode].path} onChange={(e) => updateNode(editingNode, { path: e.target.value })}
                    style={{width:'100%',padding:'0.5rem',background:'#292524',border:'1px solid #44403c',borderRadius:'0.25rem',color:'#fef3c7',boxSizing:'border-box'}}>
                    {pathOptions.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}
                  </select>
                  <div style={{width:'100%',height:'0.5rem',marginTop:'0.25rem',borderRadius:'0.25rem',background:getPathColor(nodes[editingNode].path)}} />
                </div>

                <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                  <input type="checkbox" id="isMajor" checked={nodes[editingNode].isMajor} onChange={(e) => updateNode(editingNode, { isMajor: e.target.checked })} />
                  <label htmlFor="isMajor" style={{color:'#d6d3d1',fontSize:'0.875rem'}}>Major milestone</label>
                </div>

                {nodes[editingNode].requires.length > 0 && (
                  <div>
                    <label style={{color:'#a8a29e',fontSize:'0.875rem',display:'block',marginBottom:'0.25rem'}}>Requirements</label>
                    <div style={{display:'flex',flexDirection:'column',gap:'0.25rem'}}>
                      {nodes[editingNode].requires.map(reqId => (
                        <div key={reqId} style={{display:'flex',alignItems:'center',justifyContent:'space-between',background:'#292524',padding:'0.5rem',borderRadius:'0.25rem'}}>
                          <span style={{color:'#d6d3d1',fontSize:'0.875rem'}}>{nodes[reqId]?.name}</span>
                          <button onClick={() => removeConnection(reqId, editingNode)} style={{color:'#f87171',background:'none',border:'none',cursor:'pointer'}}>‚úï</button>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <button onClick={() => deleteNode(editingNode)}
                  style={{width:'100%',padding:'0.5rem',background:'rgba(127,29,29,0.5)',color:'#f87171',borderRadius:'0.25rem',border:'none',cursor:'pointer',marginTop:'0.5rem'}}>
                  üóëÔ∏è Delete Node
                </button>
              </div>
            </div>
          )}

          {/* Legend */}
          <div style={{position:'fixed',bottom:'1rem',left:'1rem',zIndex:20,background:'rgba(28,25,23,0.95)',backdropFilter:'blur(8px)',border:'1px solid #44403c',borderRadius:'0.5rem',padding:'0.75rem'}}>
            <div style={{display:'grid',gridTemplateColumns:'repeat(2, 1fr)',gap:'0.25rem 1rem',fontSize:'0.75rem'}}>
              {pathOptions.slice(0, 8).map(p => (
                <div key={p.id} style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                  <div style={{width:'0.75rem',height:'0.75rem',borderRadius:'0.25rem',background:p.color}} />
                  <span style={{color:'#a8a29e'}}>{p.name}</span>
                </div>
              ))}
            </div>
            <div style={{marginTop:'0.5rem',paddingTop:'0.5rem',borderTop:'1px solid #44403c',fontSize:'0.75rem',color:'#57534e'}}>
              {!isEditMode && 'Tap glowing nodes to complete'}
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<SkillTreeApp />);
  </script>
</body>
</html>
